# AGENTS.md

このファイルは、このリポジトリでコードを扱う際の Codex CLI への指針を提供します。

## Conversation Guidelines

- 常に日本語で会話する
- `AGENTS.md` を更新する場合、`見出し部分は英語` で記述し、その他の内容は基本的に日本語で記述する
- コードの説明やコメントは日本語で記述する

## Development Philosophy

### Coding Principles

- YAGNI (You Aren't Gonna Need It): 今必要じゃない機能は作らない
- DRY (Don't Repeat Yourself): 同じコードを繰り返さない
- KISS (Keep It Simple Stupid): シンプルに保つ

### Test-Driven Development (TDD)

- 原則としてテスト駆動開発（TDD）で進める
- 期待される入出力に基づき、まずテストを作成する
- 実装コードは書かず、テストのみを用意する
- テストを実行し、失敗を確認する
- テストが正しいことを確認できた段階でコミットする
- その後、テストをパスさせる実装を進める
- 実装中はテストを変更せず、コードを修正し続ける
- すべてのテストが通過するまで繰り返す

### Development Workflow

以下の5つのフェーズを順番に実行する必要があります：
1. **Explore** - コードベースと要件を理解する
2. **Plan** - ソリューションアプローチを設計する
3. **Test-Driven** - ソリューションの要件を満たすテストを作成する
4. **Code** - ソリューションを実装する
5. **Commit** - 変更をレビューして最終化する

### Development Workflow

以下の5つのフェーズを順番に実行する必要があります：
1. **Explore** - コードベースと要件を理解する
2. **Plan** - ソリューションアプローチを設計する
3. **Test-Driven** - ソリューションの要件を満たすテストを作成する
4. **Code** - ソリューションを実装する
5. **Commit** - 変更をレビューして最終化する

#### Phase-Specific Instructions

##### 1. Explore Phase [ultrathink mode]

**目的**: 問題空間、コードベース構造、要件を深く理解する。

**必須アクション**:
- プロジェクト全体の構造とファイル編成を分析する
- すべての関連する依存関係とそのバージョンを特定する
- 異なるモジュール/コンポーネント間の関係をマッピングする
- 既存のパターン、規約、アーキテクチャ上の決定事項を文書化する
- すべての制約、エッジケース、潜在的な課題をリストアップする
- システムがどのように動作するかの包括的なメンタルモデルを作成する

**思考モード**: 最大深度の分析のために`ultrathink`モードを使用する。以下を考慮：
- 問題に対する複数の視点
- 隠れた依存関係と副作用
- 異なるアプローチの長期的な影響
- すぐには明らかにならないエッジケース

**出力**: 以下を含む詳細な分析ドキュメント：
- プロジェクト構造の概要
- 主要コンポーネントとその相互作用
- 特定された課題と制約
- 従うべき関連する既存パターン

##### 2. Plan Phase [ultrathink mode]

**目的**: コードを書く前に包括的なソリューション戦略を設計する。

**必須アクション**:
- 複数のソリューションアプローチを生成する（最低3つ）
- 各アプローチをプロジェクトの制約に対して評価する
- パフォーマンス、保守性、スケーラビリティを考慮する
- 明確な成功基準を定義する
- ステップバイステップの実装計画を作成する
- 潜在的なリスクと軽減戦略を特定する
- テスト戦略とテストケースの概要を設計する

**思考モード**: 徹底的な計画を確実にするために`ultrathink`モードを使用する。以下を考慮：
- 異なるアプローチ間のトレードオフ
- 将来の拡張性要件
- 既存コードとの統合ポイント
- 各コンポーネントのテスト戦略
- テストの網羅性と境界条件

**出力**: 以下を含む詳細な計画：
- 正当化付きの選択されたアプローチ
- ステップバイステップの実装ガイド
- リスク評価と軽減戦略
- 詳細なテスト計画とテストケース設計

##### 3. Test-Driven Phase [think hard mode]

**目的**: 実装前に包括的なテストスイートを作成し、TDDの「Red」フェーズを完了する。

**必須アクション**:
- Plan フェーズで設計されたテストケースを実装する
- 期待される入力、出力、振る舞いを明確に定義する
- 正常系、異常系、境界値をカバーするテストを作成する
- テストを実行し、期待通り失敗することを確認する
- テストコードの品質と可読性を確保する
- テストが実装要件を正確に反映していることを検証する
- 実装コードは一切書かない（テストのみ）

**思考モード**: 包括的なテスト設計のために`think hard`モードを使用する。以下を考慮：
- テストケースの完全性と網羅性
- エッジケースと例外的なシナリオ
- テストの独立性と再現性
- テストコードの保守性と可読性
- 将来の回帰テストとしての価値

**出力**: 
- 完全なテストスイート（すべて失敗状態）
- テストケースの説明とカバレッジ確認
- テスト実行結果の確認
- 必要に応じたテスト設計ドキュメント

##### 4. Code Phase [think hard mode]

**目的**: テストをパスさせる高品質なソリューションを実装する。

**必須アクション**:
- Test-Driven フェーズで作成されたテストを基準に実装する
- 実装計画に厳密に従う
- クリーンで十分に文書化されたコードを書く
- 包括的なエラーハンドリングを含める
- 複雑なロジックにはインラインコメントを追加する
- テストは一切変更せず、実装コードのみを修正する
- すべてのテストが通過するまで繰り返す
- コードがプロジェクトの規約に従っていることを確認する

**思考モード**: 集中的な実装のために`think hard`モードを使用する。以下を考慮：
- テスト要件を満たす最小限の実装
- コードの明確性と可読性
- 適切なエラーハンドリング
- 必要な場合のパフォーマンス最適化
- プロジェクトのスタイルガイドへの準拠

**出力**: 
- すべてのテストをパスする実装済みコード
- 必要に応じたドキュメントの更新
- テスト実行結果の確認

##### 5. Commit Phase [think mode]

**目的**: 変更をレビューし、明確なコミットメッセージを準備する。

**必須アクション**:
- すべての変更の正確性をレビューする
- 意図しない変更がないことを確認する
- 明確で説明的なコミットメッセージを書く
- 関連する変更を論理的にグループ化する
- すべてのテストが合格することを最終確認する
- テストと実装の両方を含む完全な機能をコミットする

**思考モード**: 効率的なレビューのために標準的な`think`モードを使用する。以下に焦点：
- コミットメッセージの明確性
- 変更の論理的なグループ化
- テストと実装の整合性確認
- 実装の最終確認

**出力**:
- 明確なメッセージを持つ適切に構造化されたコミット
- すべてのテストが合格することの確認
- 行われた変更の要約

#### Workflow Enforcement Rules

1. **順次実行**: 各フェーズは次に進む前に完了する必要がある
2. **スキップ禁止**: すべてのタスクで5つのフェーズすべてが必須
3. **モード遵守**: 各フェーズで指定された思考モードを使用する
4. **文書化**: 各フェーズは必要な出力を生成する必要がある
5. **レビューポイント**: フェーズ間の移行前に、すべての要件が満たされていることを確認
6. **TDD遵守**: Test-Driven フェーズでテストが失敗することを確認し、Code フェーズではテストを変更しない